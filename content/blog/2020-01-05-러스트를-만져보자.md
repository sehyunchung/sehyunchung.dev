---
title: 러스트를 만져보자
date: 2020-01-04T17:24:38.852Z
description: '!!'
---
뭐 걍.. 저수준 언어를 해보고 싶기도 하고 wasm 도 좀 만져보고 싶어서 이것저것 건드려보는 중이다.  일단 최근에 만들어본 bpm tapper의 코어 부분을 rust 로 옮겨보았다.



원래 코드는 이랬다.

```ts
export class Tapper {
  private static instance: Tapper
  private cue: number[] = []

  public static new() {
    if (!Tapper.instance) {
      Tapper.instance = new Tapper()
    }
    return Tapper.instance
  }

  tap() {
    let cur = Date.now()
    let last = this.cue[this.cue.length - 1]
    if (cur - last > 2000) {
      this.reset()
    }
    this.cue.push(cur)
  }

  reset() {
    this.cue = []
  }

  get bpm() {
    if (this.cue.length < 2) return 0

    let beatCount = this.cue.length - 1
    let first = this.cue[0]
    let last = this.cue[this.cue.length - 1]
    let averageBpm = (60000 * beatCount) / (last - first)

    return Math.round(averageBpm * 10) / 10
  }
}
```

rust로 옮겨보면 이렇다.

```rust
use chrono::Utc;

#[derive(Debug)]
struct Tapper {
    cue: Vec<i64>,
}

impl Tapper {
    pub fn new() -> Tapper {
        Tapper { cue: vec![] }
    }

    pub fn tap(&mut self) {
        let ms = Utc::now().timestamp();
        self.cue.push(ms);
    }

    pub fn reset(&mut self) {
        self.cue = vec![]
    }

    pub fn get_bpm(&self) -> i64 {
        let cue = &self.cue;
        let beats = cue.len() - 1;
        let duration = cue[0] - cue[cue.len() - 1];
        let average_bpm = 60000 * beats as i64 / duration;

        return average_bpm;
    }
}
```
