---
id: I_kwDOB4HiUc5noRP4
title: ğŸ«  Hydration Mismatch ğŸ«  (1)
createdAt: 2023-06-02T18:12:49Z
labels:
  - react
  - tips and tricks
  - next.js
  - ssr
---

ì´ëŸ° ì €ëŸ° ì´ìœ ë¡œ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë¥¼ `localStorage` ë“±ì— persist í•˜ê³  ìˆì„ ê²½ìš° server/client mismatchê°€ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ëŠ”ë° ê·¸ë˜ì„œ ì„œë²„ì—ì„œ í”„ë¦¬ë Œë”ê°€ ì•ˆë˜ê²Œ í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì€ ë‚œë¦¬ ë²•ì„ì´ í•„ìš”.

1. `useState` + `useEffect`
   ```tsx
   function Comp() {
     const storeState = useStoreState()
           ^^^^^^^^^^ 1) ìš”ê±¸ ê·¸ëƒ¥ ì“°ë©´ ğŸ’£ ì¸ ê²½ìš°,

     const [state, setState] = React.useState()
     React.useEffect(()=>{
       setState(storeState)
     },[])               // 2) ì´ëŸ° ë‚œë¦¬ ë²•ì„ í›„ì—

     return <div>{state}</div> // 3) ì´ëŸ¬ë©´ í†µê³¼
   ```
3. `useMounted` + `return null`
   ```tsx
   // 0) ì¼ë‹¨ ì´ëŸ° ë‚œë¦¬ ë²•ì„ì„ ë§Œë“¤ì–´ë‘ê³ 
   const useMounted = () => {
     const [m, sM] = React.useState(false)
     //     ^^^^^ ê·€ì°®ì•„ì„œ ëŒ€ì¶© ì”€
     React.useEffect(()=>{
       sM(true)
     }, [])
     return m
   }
   ```
   ```tsx
   function Comp() {
     const storeState = useStoreState()
           ^^^^^^^^^^ 1) ìš”ê±¸ ê·¸ëƒ¥ ì“°ë©´ ğŸ’£ ì¸ ê²½ìš°,

     const mounted = useMounted()
     if (!mounted) return null  // 2) ì´ëŸ¬ê³  ë‚˜ì„œ

     return <div>{storeState}</div> // 3) ì´ëŸ¬ë©´ í†µê³¼
   ```
5. [`next/dynamic` + `{ ssr: false }`](https://nextjs.org/docs/app/building-your-application/optimizing/lazy-loading#skipping-ssr) â˜œ ì´ê²Œ ê¸°ë¶„ì´ ì œì¼ ëœ ë‚˜ìœë“¯
   ```tsx
   const Comp = dynamic(() => import('path/to/comp'), { ssr: false }); // ì ¤ ê°„ë‹¨?
   ```
   í•˜ì§€ë§Œ ìºì¹˜ê°€ í•˜ë‚˜ ìˆëŠ”ë°, `Comp` ëŠ” ë¬´ì¡°ê±´ `export default` ì—¬ì•¼ í•¨.
   ```tsx
   const Comp = dynamic(() => import('path/to/comp').then(mod => mod.Comp), { ssr: false })
                                                       // ^^^^^^^^^^^^^^^ ì´ëŸ¬ë©´ ğŸ’£
   ```
   ëŒ€ì‹  `loading`ìœ¼ë¡œ ì„œìŠ¤íœìŠ¤ ê°„ì§€ë¥¼ ë‚¼ ìˆ˜ ìˆìŒ(...)
   ```tsx
   const Comp = dynamic(() => import('path/to/comp'), { ssr: false, loading: () => <Sekeleton /> }); // ì´ ê°€ëŠ¥
   ```
   ë¬¼ë¡  next í•œì •ì´ì§€ë§Œìš”...

---
ì´ê±° ë‹¤ ë³„ë£¨ê³ ... ë¡œ ì‹œì‘í•˜ëŠ” ê¸€ì„ í•œì°¸ ì“°ê³  ìˆì—ˆëŠ”ë° ë¸Œë¼ìš°ì € êº¼ì ¸ì„œ ë‚ ì•„ê°...
